<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <meta charset="utf-8"/>
    <title>基于WEB的在线拓扑编辑器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content=""/>

    <link href="css/bootstrap.css" type="text/css" rel="stylesheet"/>
    <link href="css/bootstrap-responsive.css" type="text/css" rel="stylesheet"/>
    <link id="theme" rel="stylesheet" type="text/css" href="themes/bootstrap/easyui.css">
    <link rel="stylesheet" type="text/css" href="themes/icon.css">
    <link id="flowPath" href="css/editor.css" type="text/css" rel="stylesheet"/>
    <link href="css/jquery.alerts.css" type="text/css" rel="stylesheet"/>
    <link href="css/header.css" type="text/css" rel="stylesheet"/>
    <link href="css/main_topology.css" type="text/css" rel="stylesheet"/>
    <link href="css/jquery.ipinput.css" type="text/css" rel="stylesheet"/>
    <link href="../css/xadmin.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="../css/font.css">
    <script type="text/javascript" src="../lib/layui/layui.js" charset="utf-8"></script>
    <script src="../lib/layui/layui.js"></script>
    <script>
        function showItem() {
            document.getElementById("item").style.display = "";
        };
        layui.use('form', function () {
            var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功

            //……

            //但是，如果你的HTML是动态生成的，自动渲染就会失效
            //因此你需要在相应的地方，执行下述方法来手动渲染，跟这类似的还有 element.init();
            form.render();
        });
    </script>
    <STYLE>
        .tp_table td {
            padding: 10px 0;
        }

        v\: * {
            behavior: url(#default#VML);
        }
    </STYLE>
</head>

<body class="easyui-layout bodySelectNone" id="body" onselectstart="return false">

<div id="title" region="north" split="false" border="false" class="titleTool" style="background: #f1f1f1;">
    <div id="header" class="navbar">
        <div class="navbar-inner">
            <!-- logo -->
            <a class="brand hidden-phone" style="float:left;"></a>
            <div style="float:right; margin:7px 10px 0 0;">
                <input id="queryText">
                <img alt="全屏查看" title="全屏查看" width="24" height="24" src="images/topology/fullScreenView.png"
                     onClick="editor.utils.showInFullScreen(editor.stage.canvas,'RequestFullScreen');"
                     class="buttonStyle"/>
                <img alt="居中显示" title="居中显示" width="24" height="24" src="images/topology/toMiddleWidth.fw.png"
                     onClick="editor.utils.showInCenter()" class="buttonStyle"/>
                <!--                  <img alt="预览"	title="预览" width="24" height="24" src="images/topology/preview.fw.png" onClick="editor.utils.showPic();" class="buttonStyle"/>-->
                <img alt="预览" title="预览" width="24" height="24" src="images/topology/preview.fw.png"
                     onClick="getStageJson();" class="buttonStyle"/>
                <img alt="保存" title="保存" width="24" height="24" src="images/topology/save.fw.png"
                     onClick="editor.saveToplogy(true)" class="buttonStyle"/>
                <img alt="删除" title="删除" width="24" height="24" src="images/topology/delete.fw.png"
                     onClick="editor.utils.deleteSelectedNodes();" class="buttonStyle"/>
                <img alt="清空" title="清空" width="24" height="24" src="images/topology/trash.fw.png"
                     onClick="editor.utils.clear();" class="buttonStyle"/>
            </div>
        </div>
    </div>


</div>
<div id="leftContent" region="west" split="true" title="设备区" class="leftContent">

    <div class="easyui-accordion overflowHidden" fit="true" border="false">
        <div title="网络构建">
            <table class="tp_table" width="100%">
                <tr>
                    <td width="100%" align="center">

                        <input type="button" onclick="downloadFile('json.html')" id="fileDownload"
                               class="layui-btn layui-btn-primary layui-btn-sm layui-btn-fluid" value="下载模板">
                    </td>
                </tr>
                <tr>
                    <td width="100%" align="center">
                        <input type="file" id="files" style="display:none" onchange="fileImport();"/>
                        <input type="button" id="fileImport"
                               class="layui-btn layui-btn-primary layui-btn-sm layui-btn-fluid    " value="导入文件">
                    </td>
                </tr>
                <tr>
                    <td width="100%" align="center">
                        <input type="button" onclick="connect()"
                               class="layui-btn layui-btn-primary layui-btn-sm layui-btn-fluid" value="生成网络">
                    </td>
                </tr>
                <tr>
                    <td width="100%" align="center">
                        <input type="button" onclick="stopnet()"
                               class="layui-btn layui-btn-primary layui-btn-sm layui-btn-fluid    " value="停止网络">
                    </td>
                </tr>
            </table>

        </div>
        <div title="网络设备" class="flowImag" style="background-color:#FFFFFF;">
            <table class="tp_table" width="100%">
                <tr>
                    <td width="100%" align="center">
                        <div id="baseLine1" divType="baseMode" gtype="L" datatype="line" draggable="false"
                             onclick="editor.lineType='line'">
                            <div class="title">&nbsp;</div>
                            <img id="simpleLine" name="backGroundImg" src="images/line1.png" class="nodeStyle"/>
                            <br><span>连线</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td width="100%" align="center">
                        <div id="Py_VM" divType="mode" datatype="Py_VM" draggable="true">
                            <div class="title">&nbsp;</div>
                            <img name="backGroundImg" src="icon/py_VM.png" class="nodeStyle"/>
                            <br><span>主机</span>
                        </div>

                    </td>
                </tr>
                <tr>
                    <td width="100%" align="center">
                        <div id="Py_ExtChange" divType="mode" datatype="Py_EC" draggable="true">
                            <div class="title">&nbsp;</div>
                            <img name="backGroundImg" src="icon/py_EC.png" class="nodeStyle"/>
                            <br><span>交换机</span>
                        </div>

                    </td>
                </tr>
                <tr>
                    <td width="100%" align="center">
                        <div id="Py_Router" divType="mode" datatype="Py_VR" draggable="true">
                            <div class="title">&nbsp;</div>
                            <img name="backGroundImg" src="icon/servervm.png" class="nodeStyle"/>
                            <br><span>控制器</span>
                        </div>

                    </td>
                </tr>
            </table>
        </div>

    </div>

</div>

<div region="center" title='当前正在编辑的拓扑图："demo"
    <img onclick="navLevel(this)" id="next" title="转到下层编辑" style="display:none;float:right;width:13px;height:4px;cursor: pointer" src="themes/icons/down.png"/>
    <select id="selectLevel" style="display:none;float:right;width:160px">
    <option value="-1">-选择切换当前编辑层-</option></select>
    <img onclick="navLevel(this)" id="pre" title="返回上层编辑" style="display:none;float:right;width:13px;height:4px;cursor: pointer" src="themes/icons/up.png"/>'
     id="contextBody" class="mapContext">

    <textarea onkeydown="if(event.keyCode==13)this.blur();"
              style="display:none;width: 60px;position: absolute;z-index: 9" id="deviceText"></textarea>

    <div id="nodeMainMenu" class="modeRight2" style="z-index: 9">
        <div class="applicationLayout" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">应用布局</span></div>
        <div id="changeNodeText" class="nodeText" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">节点文字</span></div>
        <!--        <div class="zoomBig" onMouseMove="this.style.backgroundColor='#c5e7f6'"-->
        <!--             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">放大(Shift+)</span></div>-->
        <!--        <div class="zoomSmall" onMouseMove="this.style.backgroundColor='#c5e7f6'"-->
        <!--             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">缩小(Shift-)</span></div>-->
        <!--        <div class="modeRightShunShi" onMouseMove="this.style.backgroundColor='#c5e7f6'"-->
        <!--             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">顺时针旋转(Shift+U)</span></div>-->
        <!--        <div class="modeRightNiShi" onMouseMove="this.style.backgroundColor='#c5e7f6'"-->
        <!--             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">逆时针旋转(Shift+I)</span></div>-->
        <div class="modeRightDelete" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">删除节点(Delete)</span></div>
        <div class="modeRightCopy" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">复制节点(Shift+C)</span></div>
        <!--        <div class="modeRightCancel" onMouseMove="this.style.backgroundColor='#c5e7f6'"-->
        <!--             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">撤销(Shift+Z)</span></div>-->
        <div class="modeRightRedo" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">查询流表</span></div>
    </div>

    <div id="lineMenu" class="modeRight2" style="z-index: 9">
        <div class="modeRightEdit" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">添加描述</span></div>
        <div class="modeRightDelete" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">删除连线</span></div>
    </div>

    <div id="nodeTextMenu" class="modeRight2" style="z-index: 9">
        <div class="modeRightEdit" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">修改节点文字</span></div>
        <div id="justfyNodeText" class="nodeRightEdit" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">调整节点文字位置</span></div>
    </div>

    <div id="nodeTextPosMenu" class="modeRight2" style="z-index: 9">
        <div class="theTopLeft" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">顶部居左</span></div>
        <div class="theTopCenter" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">顶部居中</span></div>
        <div class="theTopRight" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">顶部居右</span></div>
        <div class="theMiddleLeft" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">中间居左</span></div>
        <div class="center" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">居中</span></div>
        <div class="theMiddleRight" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">中间居右</span></div>
        <div class="theBottomLeft" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">底部居左</span></div>
        <div class="theBottomCenter" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">底部居中</span></div>
        <div class="theBottomRight" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">底部居右</span></div>
    </div>

    <div id="mainMenu" class="modeRight2" style="z-index: 9">
        <div class="zoomBig" onClick="editor.utils.scalingBig()" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">放大(Shift+)</span></div>
        <div class="zoomSmall" onClick="editor.utils.scalingSmall()" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">缩小(Shift-)</span></div>
        <div class="modeRightClear" onClick="editor.utils.clear();" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">清空(Shift+Y)</span></div>
<!--        <div class="modeRightPrint" onClick="editor.utils.showPic();" onMouseMove="this.style.backgroundColor='#c5e7f6'"-->
<!--             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">预览(Shift+P)</span></div>-->
        <div class="modeRightFullScreen"
             onClick="editor.utils.showInFullScreen(editor.stage.canvas,'RequestFullScreen')"
             onMouseMove="this.style.backgroundColor='#c5e7f6'" onMouseOut="this.style.backgroundColor=''"><span
                class="menuSpan">全屏查看(Shift+F)</span></div>
        <div class="modeRightCenter" onClick="editor.utils.showInCenter()"
             onMouseMove="this.style.backgroundColor='#c5e7f6'" onMouseOut="this.style.backgroundColor=''"><span
                class="menuSpan">居中显示(Shift+G)</span></div>
        <div class="modeRightSave" onClick="editor.saveToplogy(true)" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">保存(Shift+S)</span></div>
<!--        <div class="modeRigHhtSetRule" onMouseMove="this.style.backgroundColor='#c5e7f6'"-->
<!--             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan" id="ruleLineSpan">隐藏参考线(Shift+L)</span>-->
<!--        </div>-->
        <div class="viewHelp" onclick="editor.showHelpWindow()" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan" id="showHelp">查看帮助(Shift+H)</span></div>
        <div class="viewJSON"
             onclick="window.open('jsonView.html', '当前拓扑结构JSON展示', '').document.write(editor.stage.toJson())"
             onMouseMove="this.style.backgroundColor='#c5e7f6'" onMouseOut="this.style.backgroundColor=''"><span
                class="menuSpan" id="showJSON">查看拓扑JSON结构</span></div>
    </div>

    <div id="groupMangeMenu" class="modeRight2" style="z-index: 9">
        <div id="newGroup" class="modeRightEdit" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">新建分组</span></div>
        <div id="alignGroup" class="modeRightEdit" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">对齐方式</span></div>
    </div>
    <div id="groupAlignMenu" class="modeRight2" style="z-index: 9">
        <div class="modeRightMiddle" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">水平对齐</span></div>
        <div class="modeTopMiddle" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">垂直对齐</span></div>
    </div>

    <div id="containerMangeMenu" class="modeRight2" style="z-index: 9">
        <div class="modeRightDel" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">拆分</span></div>
    </div>

    <div id="layoutMenu" class="modeRight2" style="z-index: 9">
        <div class="cancelTheLayout" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">取消布局</span></div>
        <div class="packetLayout" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">分组布局</span></div>
        <div class="theTreeLayout" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">树形布局</span></div>
        <div class="circularLayout" onMouseMove="this.style.backgroundColor='#c5e7f6'"
             onMouseOut="this.style.backgroundColor=''"><span class="menuSpan">圆形布局</span></div>
    </div>
    <canvas id="drawCanvas" class="mapContext">
        您的浏览器不支持HTML5!
    </canvas>
</div>

<div region="east" split="true" title="操作区" class="history" style="width: 200px">
    <div id="mainControl" class=" overflowHidden"
         fit="true"
         border="false">
        <button type="button" class="layui-btn layui-btn-sm " onclick="appendtext('Result:&nbsp;0%&nbsp;dropped&nbsp;(30/30&nbsp;received)')"
                style="margin-top: 5px;margin-bottom: 5px;margin-left: 5px">连通性测试Ping
        </button>
        <br>
        <button onclick="showItem()" type="button" class="layui-btn layui-btn-sm "
                style="margin-top: 5px;margin-bottom: 5px;margin-left: 5px">ICMP
        </button>
        <button type="button" class="layui-btn layui-btn-sm "
                style="margin-top: 5px;margin-bottom: 5px;">ARP
        </button>
        <button type="button" class="layui-btn layui-btn-sm "
                style="margin-top: 5px;margin-bottom: 5px;">IP
        </button>
        <br>
        <button onclick="loadChart1()" type="button" class="layui-btn layui-btn-sm "
                style="margin-top: 5px;margin-bottom: 5px;margin-left: 5px">最大容量测试
        </button>
        <button onclick="loadChart2()" type="button" class="layui-btn layui-btn-sm "
                style="margin-top: 5px;margin-bottom: 5px;">时延测试
        </button>
        <button onclick="appendtext('flow&nbsp;table&nbsp;volume：2265723')" type="button" class="layui-btn layui-btn-sm "
                style="margin-top: 5px;margin-bottom: 5px;">流表容量
        </button>
        <button onclick="loadChart3()" type="button" class="layui-btn layui-btn-sm "
                style="margin-top: 5px;margin-bottom: 5px;">控制信道容量
        </button>
        <button onclick="loadChart4()" type="button" class="layui-btn layui-btn-sm "
                style="margin-top: 5px;margin-bottom: 5px;">流表查询时间
        </button>
        <button onclick="loadChart5()" type="button" class="layui-btn layui-btn-sm "
                style="margin-top: 5px;margin-bottom: 5px;">流表收敛时间
        </button>
        <div title="流量信息" style="width:100%;">

            <div id="item" style="border:1px solid lightgrey;display: none;">
                <input type="checkbox" lay-skin="switch" lay-text="ON|OFF" checked>
                <span title="[1]:ICMP echo request 10.0.0.1->10.0.0.4">[1]:ICMP-echo...</span>
            </div>
            <button onclick="editor.utils.reloadLink()" type="button" class="layui-btn layui-btn-sm "
                    style="margin-top: 5px;margin-bottom: 5px;margin-left: 5px">查看转发路径
            </button>
            <div id="infoo" style="position: absolute;top:400px;width:100%;overflow: hidden">
                <h4 style="margin-left: 5px">info：</h4>
                <div id="info"></div>
            </div>
        </div>
        <div title="info" style="width:100%;">
            <button onclick="editor.utils.reloadLink()" type="button" class="layui-btn layui-btn-sm "
                    style="margin-top: 5px;margin-bottom: 5px;">查看转发路径
            </button>
        </div>
    </div>

</div>

<div id="settings">系统设置</div>
</body>

<div id="loading">正在处理...</div>

<div id="help">帮助信息...</div>
<!-- 隐藏域用于获取moduleId和envTemplateId -->
<input type="hidden" id="nodeModuleIdHidden">
<input type="hidden" id="nodeEnvTemplateIdHidden">
<!--保存当前编辑层的父层-->
<input type="hidden" id="parentLevel" value="0">

</body>
<script src="js/util.js" type="text/javascript"></script>
<script src="js/jquery-1.7.1.min.js" type="text/javascript"></script>
<script src="js/jquery.alerts.js" type="text/javascript"></script>
<script src="js/jquery.easyui.min.js" type="text/javascript"></script>
<script src="js/jtopo-0.4.8-dev.js" type="text/javascript"></script>
<script src="js/editor.js" type="text/javascript"></script>
<script src="js/network.js" type="text/javascript"></script>
<script src="js/jquery.ipinput.js" type="text/javascript"></script>
<script src="js/topologyProperties.js" type="text/javascript"></script>
<script type="text/javascript">
    function navLevel(ele) {
        var selectEle = $("#selectLevel");
        var self = $(ele);
        var value = selectEle.find("option:selected").eq(0).val();
        var options = selectEle.find("option");
        var maxLevel = options.size() - 1;
        if (self.attr("id") == "pre") {
            //到第一层
            if (value == 1)
                return;
            else
                editor.replaceStage(editor.templateId, editor.topologyId, false, editor.stage.parentLevel);
            for (var o = 0; o < options.length; o++) {
                if (editor.stage.parentLevel == options[o].value) {
                    $(options[o]).attr("selected", "selected");
                }
            }
        }
        if (self.attr("id") == "next") {
            //到第一层
            if (value == maxLevel)
                return;
            else
                editor.replaceStage(editor.templateId, editor.topologyId, false, parseInt(value) + 1);
            for (var o = 0; o < options.length; o++) {
                if (parseInt(value) + 1 == options[o].value) {
                    $(options[o]).attr("selected", "selected");
                }
            }
        }
    }

    //节点名字加载器
    var nodeNamesloader = function (param, success, error) {
        //获取输入的值
        var q = param.q || "";
        //此处q的length代表输入多少个字符后开始查询
        if (q.length <= 0) return false;
        var nodes = editor.stage.find('node[elementType="node"]');
        var items = $.map(nodes, function (item, index) {
            if (item.text && item.text.indexOf(q) != -1) {
                return {
                    "nodeId": index,
                    "nodeName": item.text
                };
            }
        });
        success(items);
    }
    jQuery(document).ready(function () {
        //jAlert($.i18n.prop('editor.ui.selectLanguage'));
        $(document).on("contextmenu", function (e) {
            return false;
        });

        $("#simpleLine").click(function () {
            $(this).css("background-color", "darkgray");
            $("#foldLineH").css("background-color", "white");
            $("#foldLineV").css("background-color", "white");
            $("#flexLineH").css("background-color", "white");
            $("#flexLineV").css("background-color", "white");
        });
        $("#foldLineH").click(function () {
            $(this).css("background-color", "darkgray");
            $("#simpleLine").css("background-color", "white");
            $("#foldLineV").css("background-color", "white");
            $("#flexLineH").css("background-color", "white");
            $("#flexLineV").css("background-color", "white");
        });
        $("#foldLineV").click(function () {
            $(this).css("background-color", "darkgray");
            $("#simpleLine").css("background-color", "white");
            $("#foldLineH").css("background-color", "white");
            $("#flexLineH").css("background-color", "white");
            $("#flexLineV").css("background-color", "white");
        });
        $("#flexLineH").click(function () {
            $(this).css("background-color", "darkgray");
            $("#simpleLine").css("background-color", "white");
            $("#foldLineH").css("background-color", "white");
            $("#foldLineV").css("background-color", "white");
            $("#flexLineV").css("background-color", "white");
        });
        $("#flexLineV").click(function () {
            $(this).css("background-color", "darkgray");
            $("#simpleLine").css("background-color", "white");
            $("#foldLineH").css("background-color", "white");
            $("#foldLineV").css("background-color", "white");
            $("#flexLineH").css("background-color", "white");
        });

        $('#mainControl').accordion({
            onSelect: function (title) {
                //editor.selectPanel(title,editor.currentNode.templateId,editor.currDeviceId,editor.currDataType);
            }
        });

        var modes = jQuery("[divType='mode']");
        var modeLength = modes.length;

        for (var i = 0; i < modeLength; i++) {
            modes[i].gtype = modes[i].getAttribute("gtype");
            modes[i].datatype = modes[i].getAttribute("datatype");
            var text = $(modes[i]).find("span").eq(0).text();
            editor.drag(modes[i], document.getElementById('drawCanvas'), text);
        }
        //加载网络拓扑图
        editor.loadTopology("images/backimg.png", '${templateId}', '${topologyId}', "");
        $("#selectLevel").parent().css({"height": "22px", "line-height": "22px"});
        //拓扑层跳转
        $("#selectLevel").on("change", function () {
            if (this.value == -1) return false;
            editor.replaceStage(editor.templateId, editor.topologyId, false, this.value);
            $('#queryText').combobox("clear");
            $('#queryText').combobox("reload");
        });
        //搜索设备节点候选框
        $('#queryText').combobox({
            loader: nodeNamesloader,
            mode: 'remote',
            valueField: 'nodeId',
            textField: 'nodeName',
            onSelect: function (record) {
                //查该选中的设备节点
                editor.utils.findNodeAndFlash(record.nodeName);
            }
        });
        $("input[class='combo-text validatebox-text']").attr("placeholder", "输入节点名称搜素...");
    });

</script>
</html>
